// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider =  "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}


model Users {
  user_id Int @id @default(autoincrement())
  username String @unique
  email String @unique
  password String

  UserData UserDatas? 
  UserRole UserRoles[]
  Client Clients[]
  Task Tasks[]
  Note Notes[]
}

model UserDatas {
  user_data_id Int @id @default(autoincrement())
  user_id Int @unique
  first_name String 
  second_name String
  employed_from DateTime
  employed_to DateTime
  tel_number String 
  concract String

  User Users @relation(fields: [user_id],references: [user_id])
}

model Modules {
  module_id Int @id @default(autoincrement())
  name String
  
  Permission Permissions[]
}

model Roles {
  role_id Int @id @default(autoincrement())
  name String

  Permission Permissions[]
  UserRole UserRoles[]
}

model Permissions {
  permission_id Int @id @default(autoincrement())
  module_id Int
  role_id Int
  acces Boolean

  Module Modules @relation(fields: [module_id],references: [module_id])
  Role Roles @relation(fields: [role_id],references: [role_id])
}

model UserRoles {
  user_role_id Int @id @default(autoincrement())
  user_id Int 
  role_id Int

  User Users @relation(fields: [user_id],references: [user_id])
  Role Roles @relation(fields: [role_id],references: [role_id])
}

enum clientTypeValues {
  Prywatny
  Firma
}

model Clients {
  client_id Int @id @default(autoincrement())
  status_id Int
  user_id Int
  client_type clientTypeValues @default(Prywatny)
  registration_date DateTime @default(now())
  first_name String
  second_name String
  regon String @default("brak") 
  nip String @default("brak") 
  krs String @default("brak") 
  company_name String @default("brak")
  address String
  
  Status Statuses @relation(fields: [status_id], references: [status_id])
  User Users @relation(fields: [user_id],references: [user_id])
  ClientNote ClientNotes[]
  ClientTask ClientTasks[]
  Invoice Invoices[]
  ClientContact ClientContacts[]
  ClientEmail ClientEmails[]
  ClientPhone ClientPhones[]
}

model ClientEmails {
  email_id    Int    @id @default(autoincrement())
  client_id   Int
  email       String
  Client      Clients @relation(fields: [client_id], references: [client_id])

  @@unique([email])
}

model ClientPhones {
  phone_id    Int    @id @default(autoincrement())
  client_id   Int
  tel_number  String
  Client      Clients @relation(fields: [client_id], references: [client_id])

  @@unique([tel_number])
}

model ClientContacts {
  client_contacts_id Int @id @default(autoincrement())
  client_id Int
  email String @default("Brak")
  tel_number String @default("Brak")

  Client Clients @relation(fields: [client_id], references: [client_id])
}

enum statusTypeValues {
  Klient
  Pojekt
  Zadanie
  Faktura
}

model Statuses {
  status_id Int @id @default(autoincrement())
  status_type statusTypeValues
  default Boolean @default(false)
  name String

  Client Clients[]
  Task Tasks[]
  Invoice Invoices[]
}

model Notes {
  note_id Int @id @default(autoincrement())
  user_id Int
  note_name String @default("Brak")
  note_text String
  data_link String @default("Brak")
  created_at DateTime @default(now())

  ClientNote ClientNotes[]
  User Users @relation(fields: [user_id],references: [user_id])
}

model ClientNotes {
  client_note_id Int @id @default(autoincrement())
  client_id Int 
  note_id Int 

  Client Clients @relation(fields: [client_id],references: [client_id])
  Note Notes @relation(fields: [note_id],references: [note_id])
}

model Tasks {
  task_id Int @id @default(autoincrement())
  status_id Int
  user_id Int
  task_name String @default("brak")
  task_text String
  deadline DateTime? 
  created_at DateTime @default(now())

  Status Statuses @relation(fields: [status_id], references: [status_id])
  User Users @relation(fields: [user_id],references: [user_id])
  ClientTask ClientTasks[]
}

model ClientTasks {
  client_task_id Int @id @default(autoincrement())
  client_id Int
  task_id Int

  Client Clients @relation(fields: [client_id],references: [client_id])
  Task Tasks @relation(fields: [task_id],references: [task_id])
}

model Invoices {
  invoice_id     Int           @id @default(autoincrement())
  invoice_number String        @unique
  issue_date     DateTime
  due_date       DateTime
  client_id      Int
  invoice_type_id Int
  project_id     Int
  status_id      Int
  quantity       Int
  unit_price    Float
  net_amount    Float
  vat_amount    Int
  note          String
  
  Client     Clients      @relation(fields: [client_id], references: [client_id])
  InvoiceType InvoiceTypes @relation(fields: [invoice_type_id], references: [invoice_type_id])
  Project    Projects    @relation(fields: [project_id], references: [project_id])
  Status     Statuses     @relation(fields: [status_id], references: [status_id])
}

enum invoiceTypeValues {
  VAT
  Zaliczkowa
  Koncowa
  Proforma
  Okresowa
}

model InvoiceTypes {
  invoice_type_id Int     @id @default(autoincrement())
  invoice_type            invoiceTypeValues
  
  Invoice Invoices[]
}

model InvoiceSettings {
  invoice_setting_id Int     @id @default(autoincrement())
  numbering_format   String
  current_number     String
  default_currency   String
  template           String
  payment_term       Int
  vat_enabled        Boolean
  advance_enabled    Boolean
  final_enabled      Boolean
  proforma_enabled   Boolean
  periodic_enabled   Boolean
  periodic_auto_generate Boolean
  periodic_frequency String
  reminder_enabled   Boolean
  reminder_frequency Int
  reminder_content   String?
  reminder_channel_email Boolean
  reminder_channel_sms Boolean
  reminder_channel_push Boolean

  company_id Int
  Company Companies @relation(fields: [company_id], references: [company_id])
}

model InvoicePaymentSettings {
  payment_setting_id Int     @id @default(autoincrement())
  advancement_rate   Int
  tax_rate           Int
  tax_type           String @default("brak")
  default_vat_amount Int

  company_id Int
  Company Companies @relation(fields: [company_id], references: [company_id])
}

model Projects {
  project_id   Int       @id @default(autoincrement())
  project_name String
  description  String?

  Invoice Invoices[]
}

model Companies {
  company_id Int @id @default(autoincrement())
  name String
  address String
  regon String @default("brak") 
  nip String @default("brak") 
  krs String @default("brak")

  InvoicePaymentSetting InvoicePaymentSettings[]
  InvoiceSetting InvoiceSettings[]
}